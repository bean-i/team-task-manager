## 画面別フロー・バリデーション仕様

### ユーザー登録画面

| 項目 | 内容 |
|------|------|
| 画面パス | `/signup` |
| 使用API | `POST /signup` |
| 入力項目 | 名（first_name）、姓（last_name）、メールアドレス、パスワード（すべて必須） |
| バリデーション | フロントエンドで以下を実施：<br>- 名・姓：空欄チェック<br>- メールアドレス：空欄チェック、形式チェック（@を含む）<br>- パスワード：空欄チェック、8文字以上かつ記号/数字/英字を含むか |
| ボタン活性条件 | 全項目が有効な状態のときに「登録」ボタンが活性化される |
| 成功時の処理 | - ユーザー情報を受け取り、ログイン画面へリダイレクト |
| 失敗時の処理 | - エラーメッセージが中央エラーモーダルとして表示される |

---

### ログイン画面

| 項目 | 内容 |
|------|------|
| 画面パス | `/login` |
| 使用API | `POST /login` |
| 入力項目 | メールアドレス、パスワード（いずれも必須） |
| バリデーション | フロントエンドで以下を実施：<br>- メールアドレス：空欄チェック、形式チェック（@を含む）<br>- パスワード：空欄チェック、8文字以上か |
| ボタン活性条件 | 両方の項目が入力され、バリデーションを通過した場合に「ログイン」ボタンが有効になる |
| 成功時の処理 | - APIからJWTトークンとユーザー情報を取得し、`localStorage`に保存<br>- `pinia`で認証状態を管理し、ログイン済み状態として扱う |
| 失敗時の処理 | - エラーメッセージが中央エラーモーダルとして表示される |

---

### ダッシュボード画面

#### 1. ワークスペースサイドバーエリア

| 項目 | 内容 |
|------|------|
| 表示内容 | 所属中のワークスペース一覧を表示 |
| 使用API | `GET /workspaces` |
| 操作 | 各ワークスペース名をクリックすると、該当ワークスペースに遷移（`GET /workspaces/:id`） |
| ＋ボタン | モーダルを開いて、参加 or 作成操作を実行可能 |

##### 1.1 ワークスペース参加・作成モーダル

| 項目 | 内容 |
|------|------|
| タブ切替 | 「参加」「新規作成」タブ |
| 参加タブ | `GET /workspaces/available`で参加可能なリスト取得後、`POST /workspaces/:id/join`で参加実行 |
| 作成タブ | タイトル入力後、`POST /workspaces`でワークスペース新規作成を実行 |
| バリデーション | タイトル入力が空欄でないこと |
| エラー時 | 中央モーダルで表示（例：参加済み、無効な名前など） |

---

#### 2. 進捗率エリア

| 項目 | 内容 |
|------|------|
| 使用API | `GET /workspaces/:id/progress_summary` |
| 表示内容 | - 自分の進捗率：`user_id` が現在のユーザーIDの行を参照<br>- ワークスペース全体の進捗率：`user_id` が `null` の行を参照 |
| 「全体の進捗」ボタン | 押下でメンバー別進捗率のモーダルを表示（APIは同じ） |

##### 2.1 全体進捗モーダル

| 項目 | 内容 |
|------|------|
| 表示内容 | 各メンバーごとの進捗率（完了 / 合計 / 割合）をテーブルで表示 |
| 閉じる | ボタンでモーダル閉鎖 |

---

#### 3. タスクエリア

| 項目 | 内容 |
|------|------|
| 表示内容 | タスクリスト、カテゴリ・ステータス・担当者フィルター |
| 使用API | `GET /workspaces/:id`（初期表示）<br>フィルター付き：`GET /workspaces/:id?filters[...]` |
| ページネーション | `?cursor=2` 形式でカーソルベースのページネーションを使用 |
| 編集/削除制限 | 作成者（ログインユーザー）以外は編集・削除ボタンが非表示 |
| エラー処理 | API失敗時、中央エラーモーダルで通知表示 |

##### 3.1 タスク追加モーダル

| 項目 | 内容 |
|------|------|
| 使用API | `POST /workspaces/:id/tasks` |
| 入力項目 | タイトル、カテゴリ、ステータス（すべて必須） |
| バリデーション | 空欄チェック。全て入力されているときのみ「追加」ボタン有効化 |
| 成功時 | タスクリストを更新して閉じる |
| エラー時 | モーダルまたは中央エラーモーダルで通知 |

##### 3.2 タスク編集モーダル

| 項目 | 内容 |
|------|------|
| 使用API | `PATCH /workspaces/:id/tasks/:task_id` |
| 入力項目 | カテゴリ、ステータス変更（タイトル変更も可） |
| 権限制限 | 作成者のみ編集可能。そうでない場合ボタン非表示 |

---

#### 4. ログアウト操作

| 項目 | 内容 |
|------|------|
| 操作 | ログアウトボタン押下で、以下を実行：<br>- `localStorage`から`token`と`user`を削除<br>- piniaのステートも初期化し、ログアウト状態に遷移 |
| 使用API | `POST /logout`（トークン無効化処理。実際は何もしない） |

---

#### 5. 共通：エラーモーダル

| 項目 | 内容 |
|------|------|
| 表示位置 | 画面中央に赤縁のモーダルとして表示 |
| 表示条件 | ネットワークエラーやAPIレスポンスで`status=error`の時 |
| メッセージ例 | サーバーに接続できません。ネットワーク接続を確認してください。 |

---
